# build-windows.yml
---
name: build

on:
  workflow_call:
    inputs:
      aaxclean-version:
        type: string
      architecture:
        type: string
      dotnet-version:
        type: string

jobs:
  build:
    name: "win-${{ inputs.architecture }} Native"
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v6
      - name: Setup .NET
        uses: actions/setup-dotnet@v5
        with:
          dotnet-version: ${{ inputs.dotnet-version }}

      - name: Publish
        working-directory: ./src
        run: |
          dotnet publish `
              aaxclean-cli.csproj `
              --os win `
              --arch ${{ inputs.architecture }} `
              --configuration Release `
              --output ./../bin `
              -p:SelfContained=true `
              -p:PublishAot=true          

      - name: Zip artifact
        id: zip
        run: |
          $artifact="aaxclean-cli-v${{ inputs.aaxclean-version }}-windows-${{ inputs.architecture }}-native.zip"
          "artifact=$artifact" >> $env:GITHUB_OUTPUT
          Compress-Archive -Path ".\bin\*" -DestinationPath "$artifact"

      - name: Publish artifact
        uses: actions/upload-artifact@v5
        with:
          name: ${{ steps.zip.outputs.artifact }}
          path: ./${{ steps.zip.outputs.artifact }}
          if-no-files-found: error
          retention-days: 7